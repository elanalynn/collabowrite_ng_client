"use strict";function config(t,r,e){e.defaults.withCredentials=!0,r.otherwise("/"),t.state("home",{url:"/",templateUrl:"../partials/home.html"}).state("dashboard",{url:"/users/:id",templateUrl:"../partials/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.profile",{url:"/profile",templateUrl:"../partials/dashboard/profile.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.edit",{url:"/profile/edit",templateUrl:"../partials/dashboard/edit.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.stories",{url:"/stories",templateUrl:"../partials/dashboard/stories.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.chapters",{url:"/chapters",templateUrl:"../partials/dashboard/chapters.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.favorites",{url:"/favorites",templateUrl:"../partials/dashboard/favorites.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.pending",{url:"/pending",templateUrl:"../partials/dashboard/pending.html",controller:"DashboardController",controllerAs:"vm"}).state("stories",{url:"/stories",templateUrl:"../partials/stories/stories.html",controller:"StoryController",controllerAs:"vm"}).state("story_new",{url:"/stories/new",templateUrl:"../partials/stories/new.html",controller:"StoryController",controllerAs:"vm"}).state("story_detail",{url:"/stories/:id",templateUrl:"../partials/stories/story.html",controller:"StoryController",controllerAs:"vm"}).state("story_edit",{url:"/stories/:id/edit",templateUrl:"../partials/stories/edit.html",controller:"StoryController",controllerAs:"vm"}).state("chapter_new",{url:"/stories/:storyId/chapters/new",templateUrl:"../partials/chapters/new.html",controller:"ChapterController",controllerAs:"vm"}).state("chapter_detail",{url:"/stories/:storyId/chapters/:chapterId",templateUrl:"../partials/chapters/chapter.html",controller:"ChapterController",controllerAs:"vm"}).state("chapter_edit",{url:"/stories/:storyId/chapters/:chapterId/edit",templateUrl:"../partials/chapters/edit.html",controller:"ChapterController",controllerAs:"vm"}).state("profiles",{url:"/profiles",templateUrl:"../partials/users/profiles.html",controller:"UserController",controllerAs:"vm"}).state("profile",{url:"/profiles/:id",templateUrl:"../partials/users/profile.html",controller:"UserController",controllerAs:"vm"})}function ApplicationController(t,r){var e=this;t.isAuthenticated().then(function(t){return t.data.user?t.data.user.id:null}).then(function(t){return r.getUser(t).then(function(t){return e.user=t.data})})}function ChapterController(t,r,e,o,a,n){var i=this;t.storyId&&(a.getStory(t.storyId).then(function(t){return i.story=t.data}),n.getChapters(t.storyId).then(function(t){i.chapters=t.data.data,i.last_chapter=i.chapters[i.chapters.length-1]})),t.chapterId&&n.getChapter(t.storyId,t.chapterId).then(function(t){i.chapter=t.data,o.getUser(t.data.user_id).then(function(t){i.chapter.user=t.data.first_name+" "+t.data.last_name})}),i.createChapter=function(t){var o=t;e.isAuthenticated().then(function(t){return o.story_id=i.story.id,o.user_id=t.data.user.id,n.createChapter(o).then(function(t){r.url("/stories/"+t.story_id)})})}}function DashboardController(t,r,e,o,a,n,i,s){var l=this;l.chapters=[],l.favorites=[],l.getState=function(r){if(r===t.current.url)return{active:!0}},o.isAuthenticated().then(function(t){return t?t.data.id:null}).then(function(t){Promise.all([a.getUser(t).then(function(t){return l.user=t.data}),n.getUserStories(t).then(function(t){return l.stories=t.data.data,l.stories.map(function(t){return t.storyId})}).then(function(t){t.map(function(t){i.getChapters(t).then(function(t){t.data.data.forEach(function(t){l.chapters.push(t)})})})}),s.getFavoritesByUser(t).then(function(t){return t.data.map(function(t){return t.story_id})}).then(function(t){t.forEach(function(t){return n.getStory(t).then(function(t){return l.favorites.push(t.data)})})})])}),r.id&&o.isAuthorized(r.id).then(function(t){console.log(t),t.data.authorization||(console.log("Not authorized!"),e.url("/"))})}function StoryController(t,r,e,o,a,n,i){var s=this;e.isAuthenticated().then(function(t){return s.user=t.data.user}),a.getStories().then(function(t){s.stories=t.data.data}),t.id&&a.getStory(t.id).then(function(t){return s.story=t.data,s.story}).then(function(t){return Promise.all([o.getUser(t.user_id),a.getGenre(t.genre_id),n.getChapters(t.id)])}).then(function(t){s.story.user=t[0].data.first_name+" "+t[0].data.last_name,s.story.genre=t[1].data.genre,s.story.chapters=t[2].data.data,s.story.last_chapter=s.story.chapters[s.story.chapters.length-1]}),s.createStory=function(t){var o=t;e.isAuthenticated().then(function(t){return o.user_id=t.data.user.id}).then(function(){return a.createStory(o)}).then(function(t){return r.url("/stories/"+t.data.id)})},s.favorite=!1,s.favoriteToggle=function(){s.favorite===!0?(s.favorite=!1,i.setFavorite({user_id:s.user.id,story_id:s.story.id,boolean:!1}).then(function(){})):(s.favorite=!0,i.setFavorite({user_id:s.user.id,story_id:s.story.id,boolean:!0}).then(function(){}))}}function UserController(t,r,e,o){var a=this;e.isAuthenticated().then(function(t){return a.user=t}),o.getProfiles().then(function(t){return a.profiles=t.data}),t.id&&o.getProfile(t.id).then(function(t){return a.profile=t.data}),a.getProfile=function(t){return o.getProfile(t).then(function(t){return a.profile=t})},a.updateUser=function(t,e){return o.updateUser(t,e).then(function(){return r.url("/")})},a.deactivateUser=function(t){return o.deactivateUser(t).then(function(){return r.url("/")})}}function authService(t){var r={};return r.isAuthenticated=function(){return t.get("http://localhost:3000/api/v1/auth/")},r.isAuthorized=function(r){return t.get("http://localhost:3000/api/v1/auth/"+r)},r}function chapterService(t){var r={};return r.getChapters=function(r){return t.get("http://localhost:3000/api/v1/stories/"+r+"/chapters")},r.getChapter=function(r,e){return t.get("http://localhost:3000/api/v1/stories/"+r+"/chapters/"+e)},r.createChapter=function(r){return t.post("http://localhost:3000/api/v1/stories/"+r.story_id+"/chapters",r)},r}function favoriteService(t){var r={};return r.getFavoritesByUser=function(r){return t.get("http://localhost:3000/api/v1/users/"+r+"/favorites")},r.getFavoritesByStory=function(r){return t.get("http://localhost:3000/api/v1/stories/"+r+"/favorites")},r.setFavorite=function(r){return t.post("http://localhost:3000/api/v1/favorites",r)},r}function pendingService(t){var r={};return r.getPendingChapters=function(r,e){t.get("http://localhost:3000/api/v1/chapters/pending?id="+r+"&type="+e)},r}function storyService(t){var r={};return r.getStories=function(){return t.get("http://localhost:3000/api/v1/stories")},r.getStory=function(r){return t.get("http://localhost:3000/api/v1/stories/"+r)},r.getGenre=function(r){return t.get("http://localhost:3000/api/v1/genres/"+r)},r.getChapters=function(r){return t.get("http://localhost:3000/api/v1/stories/"+r+"/chapters")},r.createStory=function(r){return t.post("http://localhost:3000/api/v1/stories",r)},r.getUserStories=function(r){return t.get("http://localhost:3000/api/v1/users/"+r+"/stories")},r}function userService(t){var r={};return r.findOrCreate=function(r){return t.post("http://localhost:3000/api/v1/users/",r)},r.getProfiles=function(){return t.get("http://localhost:3000/api/v1/users")},r.getProfile=function(r){return t.get("http://localhost:3000/api/v1/users/"+r)},r.getUser=function(r){return t.get("http://localhost:3000/api/v1/users/"+r)},r.updateUser=function(r,e){return t.put("http://localhost:3000/api/v1/users/"+r,e)},r.deactivateUser=function(r){return t.put("http://localhost:3000/api/v1/users/"+r,{isActive:!1})},r.banUser=function(r){return t.put("http://localhost:3000/api/v1/users/"+r,{isBanned:!0})},r}angular.module("collabowrite",["ui.router","ngAnimate"]).config(config).controller("ApplicationController",ApplicationController).controller("ChapterController",ChapterController).controller("StoryController",StoryController).controller("UserController",UserController).controller("DashboardController",DashboardController).factory("pendingService",pendingService).factory("favoriteService",favoriteService).factory("chapterService",chapterService).factory("storyService",storyService).factory("userService",userService).factory("authService",authService),config.$inject=["$stateProvider","$urlRouterProvider","$httpProvider"],ApplicationController.$inject=["authService","userService"],ChapterController.$inject=["$stateParams","$location","authService","userService","storyService","chapterService"],DashboardController.$inject=["$state","$stateParams","$location","authService","userService","storyService","chapterService","favoriteService"],StoryController.$inject=["$stateParams","$location","authService","userService","storyService","chapterService","favoriteService"],UserController.$inject=["$stateParams","$location","authService","userService"],authService.$inject=["$http"],chapterService.$inject=["$http"],favoriteService.$inject=["$http"],pendingService.$inject=["$http"],storyService.$inject=["$http"],userService.$inject=["$http"];