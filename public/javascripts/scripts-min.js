"use strict";function config(t,e,r){r.defaults.withCredentials=!0,e.otherwise("/"),t.state("home",{url:"/",templateUrl:"../partials/home.html",controller:"ApplicationController",controllerAs:"vm"}).state("dashboard",{url:"/users/:id",templateUrl:"../partials/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.profile",{url:"/profile",templateUrl:"../partials/dashboard/profile.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.edit",{url:"/profile/edit",templateUrl:"../partials/dashboard/edit.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.stories",{url:"/stories",templateUrl:"../partials/dashboard/stories.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.chapters",{url:"/chapters",templateUrl:"../partials/dashboard/chapters.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.favorites",{url:"/favorites",templateUrl:"../partials/dashboard/favorites.html",controller:"DashboardController",controllerAs:"vm"}).state("dashboard.pending",{url:"/pending",templateUrl:"../partials/dashboard/pending.html",controller:"DashboardController",controllerAs:"vm"}).state("stories",{url:"/stories",templateUrl:"../partials/stories/stories.html",controller:"StoryController",controllerAs:"vm"}).state("story_new",{url:"/stories/new",templateUrl:"../partials/stories/new.html",controller:"StoryController",controllerAs:"vm"}).state("story_detail",{url:"/stories/:id",templateUrl:"../partials/stories/story.html",controller:"StoryController",controllerAs:"vm"}).state("story_edit",{url:"/stories/:id/edit",templateUrl:"../partials/stories/edit.html",controller:"StoryController",controllerAs:"vm"}).state("chapter_new",{url:"/stories/:storyId/chapters/new",templateUrl:"../partials/chapters/new.html",controller:"ChapterController",controllerAs:"vm"}).state("chapter_detail",{url:"/stories/:storyId/chapters/:chapterId",templateUrl:"../partials/chapters/chapter.html",controller:"ChapterController",controllerAs:"vm"}).state("chapter_edit",{url:"/stories/:storyId/chapters/:chapterId/edit",templateUrl:"../partials/chapters/edit.html",controller:"ChapterController",controllerAs:"vm"}).state("profiles",{url:"/profiles",templateUrl:"../partials/users/profiles.html",controller:"UserController",controllerAs:"vm"}).state("profile",{url:"/profiles/:id",templateUrl:"../partials/users/profile.html",controller:"UserController",controllerAs:"vm"})}function ApplicationController(t,e,r,o){var n=this;n.user=null,e.getCurrentUser().then(function(t){return t.data.user?t.data.user.id:null}).then(function(t){t&&r.getUser(t).then(function(t){n.user=t.data})}),n.setCurrentUser=function(t){n.user=t}}function ChapterController(t,e,r,o,n,a){var s=this;t.storyId&&(n.getStory(t.storyId).then(function(t){return s.story=t.data}),a.getChaptersByStory(t.storyId).then(function(t){s.chapters=t.data.data,s.last_chapter=s.chapters[s.chapters.length-1]})),t.chapterId&&a.getChapter(t.storyId,t.chapterId).then(function(t){s.chapter=t.data,o.getUser(t.data.user_id).then(function(t){s.chapter.user=t.data.first_name+" "+t.data.last_name})}),s.createChapter=function(t){var o=t;r.getCurrentUser().then(function(t){return o.story_id=s.story.id,o.user_id=t.data.user.id,a.createChapter(o).then(function(t){e.url("/stories/"+t.data.id)})})}}function DashboardController(t,e,r,o,n,a,s,i){var l=this;l.chapters=[],l.favorites=[],l.icon="face",l.getState=function(e){if(e===t.current.url)return{active:!0}},o.isAuthorized(e.id)&&o.getCurrentUser().then(function(t){return t.data.user?t.data.user.id:null}).then(function(t){Promise.all([n.getUser(t).then(function(t){l.user=t.data}),a.getStoriesByUser(t).then(function(t){return l.stories=t.data.data,l.stories.map(function(t){return t.storyId})}).then(function(t){t.map(function(t){s.getChaptersByStory(t).then(function(t){t.data.data.forEach(function(t){l.chapters.push(t)})})})}),i.getFavoritesByUser(t).then(function(t){return t.data.map(function(t){return t.story_id})}).then(function(t){t.forEach(function(t){return a.getStory(t).then(function(t){return l.favorites.push(t.data)})})})])}),l.updateProfile=function(e){n.updateUser(e).then(function(){t.go("dashboard.profile")})},l.deactivateUser=function(e){n.deactivateUser(e).then(function(){t.go("home")})}}function StoryController(t,e,r,o,n,a,s,i,l){var c=this;c.user=null,c.search="",o.getCurrentUser().then(function(t){c.user=t.data.user,e.id&&o.isAuthorized(e.id).then(function(t){c.isAuthorized=t.data.authorized})}),"stories"===t.current.name&&a.getStories().then(function(t){c.stories=t.data.data}),"story_detail"===t.current.name&&(a.getStory(e.id).then(function(t){return c.story=t.data,c.story}).then(function(t){return Promise.all([n.getUser(t.user_id),a.getGenre(t.genre_id),s.getChaptersByStory(t.id)])}).then(function(t){c.story.user=t[0].data.first_name+" "+t[0].data.last_name,c.story.genre=t[1].data.genre,c.story.chapters=t[2].data.data,c.story.last_chapter=c.story.chapters[c.story.chapters.length-1]}),c.styleGenre(1)),"story_new"===t.current.name&&(c.story={},a.getGenres().then(function(t){c.genres=t.data,c.story.genre_id=c.genres[0]}),c.createStory=function(t){var e={title:t.title,summary:t.summary,cover:t.cover,genre_id:t.genre_id.id};o.getCurrentUser().then(function(t){return e.user_id=t.data.user.id}).then(function(){return a.createStory(e)}).then(function(t){return r.url("/stories/"+t.data.id)})}),"story_edit"===t.current.name&&a.getStory(e.id).then(function(t){a.getGenres().then(function(e){c.story=t.data,c.genres=e.data,c.story.genre_id=c.genres[0]})}),c.updateStory=function(t){a.updateStory(t).then(function(t){return t})},c.deleteStoryPopup=function(){l.open({template:"/partials/stories/deletePopup.html",controller:"StoryController",controllerAs:"vm"})},c.deleteStory=function(t){a.deleteStory(t).then(function(t){return t})},c.favoriteToggle=function(){c.favorite===!0?(c.favorite=!1,i.setFavorite({user_id:c.user.id,story_id:c.story.id,boolean:!1}).then(function(){})):(c.favorite=!0,i.setFavorite({user_id:c.user.id,story_id:c.story.id,boolean:!0}).then(function(){}))},c.genreClass=function(t){switch(t){case 1:return"lets-see-what-happens";case 2:return"childrens";case 3:return"comedy";case 4:return"drama";case 5:return"fantasy";case 6:return"historical";case 7:return"horror";case 8:return"mystery";case 9:return"romance";case 10:return"satire";case 11:return"scifi";case 12:return"tragedy";default:return""}}}function UserController(t,e,r,o,n,a){var s=this;s.search="",o.getCurrentUser().then(function(t){return s.user=t}),s.updateUser=function(t,e){return n.updateUser(t,e).then(function(){return r.url("/")})},s.deactivateUser=function(t){return n.deactivateUser(t).then(function(){return r.url("/")})},"profiles"===e.current.name&&n.getProfiles().then(function(t){s.profiles=t.data,s.profiles.map(function(t){a.getStoriesByUser(t.id).then(function(e){t.stories=e.data.data})})}),"profile"===e.current.name&&n.getProfile(t.id).then(function(t){s.profile=t.data})}function cwProfileMenuIcon(){return{restrict:"E",templateUrl:"/templates/cw-profile-menu-icon.html",scope:"="}}function authService(t,e){var r={};return r.getCurrentUser=function(){return t.get("http://localhost:3000/api/v1/auth/")},r.isAuthorized=function(e){return t.get("http://localhost:3000/api/v1/auth/"+e)},r}function chapterService(t){var e={};return e.getChaptersByStory=function(e){return t.get("http://localhost:3000/api/v1/stories/"+e+"/chapters")},e.getChapter=function(e){return t.get("http://localhost:3000/api/v1/chapters/"+e)},e.createChapter=function(e){return t.post("http://localhost:3000/api/v1/chapters",e)},e}function favoriteService(t){var e={};return e.getFavoritesByUser=function(e){return t.get("http://localhost:3000/api/v1/users/"+e+"/favorites")},e.getFavoritesByStory=function(e){return t.get("http://localhost:3000/api/v1/stories/"+e+"/favorites")},e.setFavorite=function(e){return t.post("http://localhost:3000/api/v1/favorites",e)},e}function pendingService(t){var e={};return e.getPendingChapters=function(e,r){t.get("http://localhost:3000/api/v1/chapters/pending?id="+e+"&type="+r)},e}function sessionService(){this.create=function(t,e,r){this.id=t,this.userId=e,this.userRole=r},this.destroy=function(){this.id=null,this.userId=null,this.userRole=null}}function storyService(t){var e={};return e.getStories=function(){return t.get("http://localhost:3000/api/v1/stories")},e.getStory=function(e){return t.get("http://localhost:3000/api/v1/stories/"+e)},e.getGenres=function(){return t.get("http://localhost:3000/api/v1/genres/")},e.getGenre=function(e){return t.get("http://localhost:3000/api/v1/genres/"+e)},e.getChapters=function(e){return t.get("http://localhost:3000/api/v1/stories/"+e+"/chapters")},e.createStory=function(e){return t.post("http://localhost:3000/api/v1/stories",e)},e.updateStory=function(e){return t.put("http://localhost:3000/api/v1/stories/"+e.id,e)},e.deleteStory=function(e){return t.delete("http://localhost:3000/api/v1/stories/"+e)},e.getStoriesByUser=function(e){return t.get("http://localhost:3000/api/v1/users/"+e+"/stories")},e}function userService(t){var e={};return e.findOrCreate=function(e){return t.post("http://localhost:3000/api/v1/users/",e)},e.getProfiles=function(){return t.get("http://localhost:3000/api/v1/users")},e.getProfile=function(e){return t.get("http://localhost:3000/api/v1/users/"+e)},e.getUser=function(e){return t.get("http://localhost:3000/api/v1/users/"+e)},e.updateUser=function(e){return t.put("http://localhost:3000/api/v1/users/"+e.id,e)},e.deactivateUser=function(e){return t.put("http://localhost:3000/api/v1/users/"+e,{is_active:!1})},e.banUser=function(e){return t.put("http://localhost:3000/api/v1/users/"+e,{is_banned:!0})},e}angular.module("collabowrite",["ui.router","ngAnimate","ngDialog"]).config(config).controller("ApplicationController",ApplicationController).controller("ChapterController",ChapterController).controller("StoryController",StoryController).controller("UserController",UserController).controller("DashboardController",DashboardController).factory("pendingService",pendingService).factory("favoriteService",favoriteService).factory("chapterService",chapterService).factory("storyService",storyService).factory("userService",userService).factory("authService",authService).service("sessionService",sessionService).directive("cwProfileMenuIcon",cwProfileMenuIcon),config.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider"],ApplicationController.$inject=["$stateParams","authService","userService","$rootScope"],ChapterController.$inject=["$stateParams","$location","authService","userService","storyService","chapterService"],DashboardController.$inject=["$state","$stateParams","$location","authService","userService","storyService","chapterService","favoriteService"],StoryController.$inject=["$state","$stateParams","$location","authService","userService","storyService","chapterService","favoriteService","ngDialog"],UserController.$inject=["$stateParams","$state","$location","authService","userService","storyService"],authService.$inject=["$http","sessionService"],chapterService.$inject=["$http"],favoriteService.$inject=["$http"],pendingService.$inject=["$http"],storyService.$inject=["$http"],userService.$inject=["$http"];